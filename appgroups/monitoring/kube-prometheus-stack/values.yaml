kube-prometheus-stack:
  chunksCache:
    enabled: false
  crds:
    upgradeJob:
      enabled: true
  alertmanager:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - alertmanager.monitoring.abode.tailandtraillabs.org
      tls:
        - secretName: alertmanager-tls
          hosts:
            - alertmanager.monitoring.abode.tailandtraillabs.org
    alertmanagerSpec:
      externalUrl: https://alertmanager.monitoring.abode.tailandtraillabs.org
    config:
      global:
        resolve_timeout: 5m
        smtp_smarthost: 'smtp.gmail.com:587'
        smtp_from: 'bob@bomar.us'
        smtp_auth_username: 'bob@bomar.us'
        smtp_auth_password: '{{ secret "alertmanager-smtp" "password" }}'
        smtp_require_tls: true
      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 12h
        receiver: 'email-bob'
        routes:
          - match:
              severity: critical
            receiver: 'email-bob'
            repeat_interval: 1h
      receivers:
        - name: 'email-bob'
          email_configs:
            - to: 'bob@bomar.us'
              send_resolved: true
              headers:
                Subject: '[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} - {{ .GroupLabels.cluster }}'
  grafana:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - grafana.monitoring.abode.tailandtraillabs.org
      tls:
        - secretName: grafana-tls
          hosts:
            - grafana.monitoring.abode.tailandtraillabs.org
    adminUser: admin
    adminPassword: admin
    additionalDataSources:
      - name: Loki
        type: loki
        url: http://loki-gateway.monitoring.svc.cluster.local:80
        access: proxy
        isDefault: false
  prometheus:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - prometheus.monitoring.abode.tailandtraillabs.org
      paths:
        - /
      pathType: Prefix
      tls:
        - secretName: prometheus-tls
          hosts:
            - prometheus.monitoring.abode.tailandtraillabs.org
    prometheusSpec:
      enableRemoteWriteReceiver: false
      externalUrl: https://prometheus.monitoring.abode.tailandtraillabs.org
      remoteWrite: []
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: local-path
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 50Gi

loki:
  chunksCache:
    enabled: false
  deploymentMode: SingleBinary
  
  loki:
    auth_enabled: false
    commonConfig:
      replication_factor: 1
    storage:
      type: filesystem
    schemaConfig:
      configs:
        - from: "2024-04-01"
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: loki_index_
            period: 24h
    pattern_ingester:
      enabled: true
    limits_config:
      allow_structured_metadata: true
      volume_enabled: true
      retention_period: 744h
    compactor:
      retention_enabled: true
      delete_request_store: filesystem
    ruler:
      enable_api: true
      storage:
        type: local
        local:
          directory: /var/loki/rules
      rule_path: /tmp/loki/scratch

  singleBinary:
    replicas: 1
    persistence:
      enabled: true
      storageClass: local-path
      size: 50Gi
    extraVolumes:
      - name: rules
        emptyDir: {}
    extraVolumeMounts:
      - name: rules
        mountPath: /var/loki/rules

  gateway:
    enabled: true
    replicas: 1
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      hosts:
        - host: loki.monitoring.abode.tailandtraillabs.org
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: loki-tls
          hosts:
            - loki.monitoring.abode.tailandtraillabs.org

  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0

  monitoring:
    selfMonitoring:
      enabled: false
      grafanaAgent:
        installOperator: false
    lokiCanary:
      enabled: false

  test:
    enabled: false