kube-prometheus-stack:
  crds:
    upgradeJob:
      enabled: true
  alertmanager:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - alertmanager.monitoring.abode.tailandtraillabs.org
      tls:
        - secretName: alertmanager-tls
          hosts:
            - alertmanager.monitoring.abode.tailandtraillabs.org
    alertmanagerSpec:
      externalUrl: https://alertmanager.monitoring.abode.tailandtraillabs.org
    config:
      global:
        resolve_timeout: 5m
        smtp_smarthost: 'smtp.gmail.com:587'
        smtp_from: 'bob@bomar.us'
        smtp_auth_username: 'bob@bomar.us'
        smtp_auth_password: '{{ secret "alertmanager-smtp" "password" }}'
        smtp_require_tls: true
      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 12h
        receiver: 'email-bob'
        routes:
          - match:
              severity: critical
            receiver: 'email-bob'
            repeat_interval: 1h
      receivers:
        - name: 'email-bob'
          email_configs:
            - to: 'bob@bomar.us'
              send_resolved: true
              headers:
                Subject: '[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} - {{ .GroupLabels.cluster }}'
  grafana:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - grafana.monitoring.abode.tailandtraillabs.org
      tls:
        - secretName: grafana-tls
          hosts:
            - grafana.monitoring.abode.tailandtraillabs.org
    adminUser: admin
    adminPassword: admin
  prometheus:
    enabled: true
    ingress:
      enabled: true
      ingressClassName: monitoring-traefik
      annotations:
        kubernetes.io/ingress.class: monitoring-traefik
      hosts:
        - prometheus.monitoring.abode.tailandtraillabs.org
      tls:
        - secretName: prometheus-tls
          hosts:
            - prometheus.monitoring.abode.tailandtraillabs.org

loki:
  loki:
    gateway:
      enabled: true
      ingress:
        enabled: true
        ingressClassName: monitoring-traefik
        hosts:
          - host: loki.monitoring.abode.tailandtraillabs.org
        tls:
          - secretName: loki-tls
            hosts:
              - loki.monitoring.abode.tailandtraillabs.org
    commonConfig:
      replication_factor: 1
    schemaConfig:
      configs:
        - from: "2024-04-01"
          store: tsdb
          object_store: s3
          schema: v13
          index:
            prefix: loki_index_
            period: 24h
    pattern_ingester:
        enabled: true
    limits_config:
      allow_structured_metadata: true
      volume_enabled: true
    ruler:
      enable_api: true

  minio:
    enabled: false
        
  deploymentMode: SingleBinary

  singleBinary:
    replicas: 1

  # Zero out replica counts of other deployment modes
  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0

  ingester:
    replicas: 0
  querier:
    replicas: 0
  queryFrontend:
    replicas: 0
  queryScheduler:
    replicas: 0
  distributor:
    replicas: 0
  compactor:
    replicas: 0
  indexGateway:
    replicas: 0
  bloomCompactor:
    replicas: 0
  bloomGateway:
    replicas: 0
  